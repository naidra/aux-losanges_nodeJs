<%- include('../partials/header.ejs') %>

  <div class="pagetitle">
    <h1>Ndrysho klientin</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Hyrja</a></li>
        <li class="breadcrumb-item">Peroruesit</li>
        <li class="breadcrumb-item active">Ndrysho klientin</li>
      </ol>
    </nav>
  </div><!-- End Page Title -->
  <section class="section">
    <div class="card container-xxl">
      <form class="card-body" method="post">
        <h3 class="fw-normal mb-5 mt-4" style="color: #4835d4;">Informacionet Bazike</h3>
        <div class="row">
          <div class="col-md-4 mb-4 pb-2">

            <div class="form-outline">
              <input type="text" id="form3Examplev2" class="form-control form-control-lg" name="name" value="<%= client_data.name %>" required />
              <label class="form-label" for="form3Examplev2">Emri</label>
            </div>

          </div>
          <div class="col-md-4 mb-4 pb-2">

            <div class="form-outline">
              <input type="text" id="form3Examplev3" class="form-control form-control-lg" name="lastName" value="<%= client_data.lastName %>" required />
              <label class="form-label" for="form3Examplev3">Mbiemri</label>
            </div>

          </div>

          <div class="col-md-4 mb-4 pb-2">

            <div class="form-outline">
              <input type="number" id="form3Examplev2" class="form-control form-control-lg" name="personalId" value="<%= client_data.personalId %>" required />
              <label class="form-label" for="form3Examplev2">ID Personale</label>
            </div>

          </div>
          <div class="col-md-4 mb-4 pb-2">
            <select class="form-select" aria-label="Default select example" name="gender" required>
              <option>Zgjedh Gjinin</option>
              <option value="mashkull" <% if (client_data.gender === "mashkull") { %>selected<% } %>>Mashkull</option>
              <option value="femer" <% if (client_data.gender === "femer") { %>selected<% } %>>Femer</option>
            </select>
          </div>

        </div>

        <h3 class="fw-normal mb-5 " style="color: #4835d4;">Zgjedh pakon</h3>
        <div class="row">
          <div class="col-md-4 mb-4 mt-2 mb-2 ">
            <select id="packagesSelect" class="form-select" aria-label="Default select example" name="package" required>
              <option value="">Zgjedh nje pako</option>
              <% for (var i = 0; i < packages.length; i++ ) { %>
                <option value="<%= packages[i]._id %>" <% if (client_data.package.id == packages[i]._id) { %>selected<% } %>><%= packages[i].packageName %></option>
              <% } %>
            </select>
          </div>
          <div class="col-md-4 mb-4 mt-2 mb-2 ">
            <select class="form-select" aria-label="Default select example" name="paymentForm" value="<%= client_data.paymentForm %>" required>
              <option>Forma Pagesës</option>
              Pako
            </select>
          </div>

          <div class="row">
            <div class="col-md-4 mb-4 mt-5 mb-2 ">
              <select class="form-select" aria-label="Default select example" name="paymentManner" value="<%= client_data.paymentManner %>" required>
                <option>Mënyra Pagesës</option>
                Pako
              </select>
            </div>
            <div class="col-md-4 mb-4 mt-5 mb-2">
              <select class="form-select" aria-label="Default select example" name="monthsFree" value="<%= client_data.monthsFree %>" required>
                <option>Muaj Falas</option>
                Pako
              </select>
            </div>
            <div class="row">
              <div class="col-md-4 mb-4 mt-5 mb-2">
                <select id="devicesSelect" class="form-select" aria-label="Default select example" multiple>
                  <option>Paisje të lejuara</option>
                </select>
              </div>
              <div class="col-md-4 mb-4 mt-5 mb-2">
                <select class="form-select" aria-label="Default select example" name="role" value="<%= client_data.role %>" required>
                  <option value="">Zgjedh grupin</option>
                  <% for (var i = 0; i < roles.length; i++ ) { %>
                    <option value="<%= roles[i]._id %>" <% if (client_data.role.id == roles[i]._id) { %>selected<% } %>><%= roles[i].roleName %></option>
                  <% } %>
                </select>
              </div>

              <h3 class="fw-normal mb-5 mt-4" style="color: #4835d4;">Detajet e Kontaktit</h3>
              <div class="row">
                <div class="col-md-5 mb-4 pb-2">
                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea2" class="form-control form-control-lg" name="email" value="<%= client_data.email %>" required />
                    <label class="form-label" for="form3Examplea2">Email Adresa</label>
                  </div>
                </div>
<!-- 
                <div class="col-md-5 mb-4 pb-2">
                  <div class="form-outline form-white">
                    <input type="password" id="form3ExampleaPassword" class="form-control form-control-lg" name="password" value="<%= client_data.password %>" required />
                    <label class="form-label" for="form3ExampleaPassword">Password</label>
                  </div>
                </div> -->

                <div class="col-md-5 mb-4 pb-2">
                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea6" class="form-control form-control-lg" name="address" value="<%= client_data.address %>" required />
                    <label class="form-label" for="form3Examplea6">Adresa</label>
                  </div>
                </div>

                <div class="col-md-5 mb-4 pb-2">
                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea3" class="form-control form-control-lg" name="hoodName" value="<%= client_data.hoodName %>" required />
                    <label class="form-label" for="form3Examplea3">Lagjja</label>
                  </div>
                </div>

                <div class="col-md-5 mb-4 pb-2">
                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea4" class="form-control form-control-lg" name="apartmentNumber" value="<%= client_data.apartmentNumber %>" required />
                    <label class="form-label" for="form3Examplea4">Nr Baneses</label>
                  </div>

                </div>
                <div class="col-md-5 mb-4 pb-2">
                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea5" class="form-control form-control-lg" name="floorNumber" value="<%= client_data.floorNumber %>" required />
                    <label class="form-label" for="form3Examplea5">Nr Katit</label>
                  </div>

                </div>

                <div class="col-md-5 mb-4 pb-2">

                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea7" class="form-control form-control-lg" name="codePlus" value="<%= client_data.codePlus %>" required />
                    <label class="form-label" for="form3Examplea7">Kodi +</label>
                  </div>

                </div>
                <div class="col-md-5 mb-4 pb-2">

                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea8" class="form-control form-control-lg" name="phoneNumber" value="<%= client_data.phoneNumber %>" required />
                    <label class="form-label" for="form3Examplea8">Numri Telefonit</label>
                  </div>

                </div>


                <div class="col-md-5 mb-4 pb-2">
                  <div class="form-outline form-white">
                    <input type="text" id="form3Examplea9" class="form-control form-control-lg" name="secondaryAddress" value="<%= client_data.secondaryAddress %>">
                    <label class="form-label" for="form3Examplea9">Adresa (nqofse nuk jeton aty)</label>
                  </div>
                </div>

                <div class="row container-xxl">
                  <div class="col-8 mb-4 pb-2">
                    <button type="submit" class="btn btn-danger btn-lg" data-mdb-ripple-color="dark">Ndrysho</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>
  <script>
    const packagesSelect = document.querySelector('#packagesSelect');
    const devicesSelect = document.querySelector('#devicesSelect');

    async function syncPackageDevices() {
      if (packagesSelect.value.trim().length) {
        const response = await fetch(`/packages/fetchDevices/${packagesSelect.value}`);
        const responseData = await response.json();
        devicesSelect.innerHTML = '<option>Paisje të lejuara</option>' + responseData.map(device => `<option value="${device._id}">${device.deviceName}</option>`).join('');
      }
    }

    packagesSelect.addEventListener('input', e => syncPackageDevices());
    onload = () => syncPackageDevices();
  </script>

<%- include('../partials/footer.ejs') %>